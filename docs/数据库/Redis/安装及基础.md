---
tags:
  - Redis
---
Redis入门必备：部署、命令与注意事项全解析

## 一、Redis单点部署：快速搭建基础环境

单点部署是Redis最基础的部署方式，适用于开发环境、测试环境或者访问量较小的小型生产环境，部署步骤简单易懂，具体如下：

### 1.1 环境准备

Redis对环境要求较低，主流的Linux系统（如CentOS、Ubuntu）均可支持。首先需确保系统安装了gcc编译工具，因为Redis需要源码编译安装。若未安装，可执行以下命令：

```
CentOS系统：yum install -y gcc
Ubuntu系统：apt-get install -y gcc
```

### 1.2 下载与编译安装

1. 下载Redis源码包：建议从Redis官方网站（https://redis.io/）获取稳定版本，这里以Redis 6.2.14为例（长期支持版本，稳定性更佳）。执行命令：

```
wget https://download.redis.io/releases/redis-6.2.14.tar.gz
```

2. 解压源码包：

```
tar -zxvf redis-6.2.14.tar.gz
```

3. 进入解压后的目录：

```
cd redis-6.2.14
```

4. 编译源码：

```
make
```

5. 安装Redis：

```
# PREFIX指定安装路径
make install PREFIX=/usr/local/redis，
```

### 1.3 配置与启动

1. 复制配置文件：进入Redis源码包的redis.conf文件所在目录（即解压后的目录），将配置文件复制到安装目录的etc文件夹下（需先创建etc目录）：

```
mkdir /usr/local/redis/etc
cp redis.conf /usr/local/redis/etc/
```

2. 修改配置文件：编辑/usr/local/redis/etc/redis.conf，主要修改以下几个关键配置（根据需求调整）：

```
daemonize yes：设置为后台启动模式；
bind 0.0.0.0：允许所有IP访问（生产环境建议指定具体IP）；
requirepass yourpassword：设置Redis访问密码（增强安全性，必设项）；
logfile "/usr/local/redis/log/redis.log"：指定日志文件路径（需先创建log目录）。
```

3. 启动Redis：进入安装目录的bin目录，执行启动命令：

```
cd /usr/local/redis/bin
./redis-server ../etc/redis.conf
```

4. 验证启动：

```
./redis-cli -h 127.0.0.1 -p 6379 -a yourpassword
```

## 二、Redis集群部署：满足高可用与高并发需求

单点部署虽然简单，但存在单点故障风险，一旦Redis服务宕机，会导致整个缓存系统失效。对于生产环境，尤其是高并发场景，集群部署是必然选择。Redis集群采用主从复制+哨兵模式或Redis Cluster模式，这里重点介绍应用更广泛的Redis Cluster模式（去中心化，支持自动分片和故障转移），部署以3主3从为例。

### 2.1 环境准备

准备6台Linux服务器（或在单台服务器上通过不同端口模拟，这里以单台服务器模拟为例），每台服务器安装好Redis（步骤同单点部署的1.1-1.2，无需启动）。模拟时创建6个目录，分别对应6个节点，端口为7001-7006：

```
mkdir -p /usr/local/redis-cluster/{7001,7002,7003,7004,7005,7006}
```

### 2.2 节点配置

1. 复制Redis安装目录的bin目录到每个节点目录下，以7001节点为例：

```
# 其余节点执行相同操作。
cp -r /usr/local/redis/bin /usr/local/redis-cluster/7001/
```

2. 为每个节点创建配置文件redis.conf，以7001节点为例，配置内容如下：

```
dir /usr/local/redis-cluster/7001/data（数据存储目录，需提前创建）
```

```
daemonize yes
port 7001
bind 0.0.0.0
requirepass yourpassword
masterauth yourpassword（主从节点通信密码，需与requirepass一致）
cluster-enabled yes（开启集群模式）
cluster-config-file nodes-7001.conf（集群节点配置文件，自动生成）
cluster-node-timeout 15000（节点超时时间）
logfile "/usr/local/redis-cluster/7001/redis.log"
```
3. 修改其余节点的配置文件，将端口、配置文件名、日志路径、数据目录等对应修改为7002-7006的对应信息。

2.3 启动节点与创建集群

1. 启动所有节点：编写启动脚本批量启动，或逐个节点启动，以7001节点为例：

```
/usr/local/redis-cluster/7001/bin/redis-server
/usr/local/redis-cluster/7001/redis.conf
```
其余节点执行类似命令，启动后通过ps -ef | grep redis确认6个节点均启动成功。

2. 创建集群：Redis 5.0及以上版本自带redis-cli集群创建工具，无需额外安装ruby。执行以下命令（替换为实际IP和端口）：
```
/usr/local/redis/bin/redis-cli -a yourpassword --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1
```
其中--cluster-replicas 1表示每个主节点对应1个从节点，执行后会自动分配主从节点，输入yes确认即可。
3. 验证集群：连接任意节点，执行cluster info查看集群状态，执行cluster nodes查看节点分布情况，若主从节点分配正常且集群状态为ok，则集群创建成功。
三、Redis常用命令：提升操作效率

Redis支持丰富的命令，涵盖键操作、数据结构操作等，以下是开发中最常用的命令分类整理：

3.1 基础键操作

```
- keys *：查询所有键（生产环境慎用，数据量大时会阻塞服务）；
- exists key：判断键是否存在，返回1表示存在，0表示不存在；
- del key1 key2...：删除指定键，返回删除成功的键的数量；
- expire key seconds：设置键的过期时间（秒），pexpire key milliseconds设置毫秒级过期时间；
- ttl key：查看键的剩余过期时间，-1表示永久有效，-2表示已过期；
- type key：查看键对应的值的类型。
```
### 3.2 核心数据结构操作

3.2.1 字符串（String）

- set key value：设置键值对，可加nx（不存在时设置）、xx（存在时设置）等参数；
- get key：获取键对应的值；
- mset key1 value1 key2 value2...：批量设置键值对；
- mget key1 key2...：批量获取键的值；
- incr key：键对应的值自增1（值需为整数），decr key自减1；
- incrby key num：指定自增步长为num。

3.2.2 哈希（Hash）

- hset hashKey field value：给哈希表设置字段和值；
- hget hashKey field：获取哈希表中指定字段的值；
- hmset hashKey field1 value1 field2 value2...：批量设置哈希表字段；
- hmget hashKey field1 field2...：批量获取哈希表字段值；
- hgetall hashKey：获取哈希表中所有字段和值；
- hdel hashKey field1 field2...：删除哈希表中指定字段。

3.2.3 列表（List）

- lpush listKey value1 value2...：从列表左侧插入元素；
- rpush listKey value1 value2...：从列表右侧插入元素；
- lpop listKey：从列表左侧弹出元素；
- rpop listKey：从列表右侧弹出元素；
- lrange listKey start end：获取列表中从start到end的元素（0表示开头，-1表示结尾）。

3.2.4 集合（Set）

```
- sadd setKey value1 value2...：向集合中添加元素；
- smembers setKey：获取集合中所有元素；
- sismember setKey value：判断元素是否在集合中；
- srem setKey value1 value2...：删除集合中指定元素；
- sinter setKey1 setKey2：求两个集合的交集。
```

3.3 集群相关命令

```
- cluster info：查看集群状态；
- cluster nodes：查看集群节点信息；
- cluster meet ip port：添加新节点到集群；
- cluster failover：手动触发从节点晋升为主节点。
```

## 四、Redis使用注意事项：避坑指南

Redis虽好用，但如果使用不当，很容易出现性能问题或数据安全风险，以下是必须注意的几点：

### 4.1 数据安全类

- 设置访问密码：生产环境必须设置复杂密码，避免未授权访问导致数据泄露或被恶意攻击（如挖矿）。

- 开启持久化：根据业务需求选择合适的持久化方式，RDB适合数据备份（定时快照），AOF适合数据恢复（实时日志），建议生产环境开启AOF+RDB组合模式，确保数据不丢失。

- 限制访问IP：通过bind配置指定允许访问的IP，避免公网直接暴露Redis服务。

### 4.2 性能优化类

- 避免阻塞命令：如keys *、hgetall等，这些命令会遍历全量数据，在数据量大时导致Redis阻塞，可使用scan、hscan等迭代命令替代。

- 合理设置过期时间：避免大量键同时过期导致的性能波动，可通过给过期时间加随机值实现分散过期；同时及时删除无效键，释放内存空间。

- 控制键值大小：单个键的值不宜过大（建议不超过100KB），过大的键会增加网络传输时间和内存占用，影响读写性能。

### 4.3 集群部署类

- 主从节点分离：主节点负责读写，从节点负责备份和读请求分流，避免主节点压力过大；同时确保主从节点网络通畅，减少复制延迟。

- 合理分配槽位：Redis Cluster通过槽位分配数据，确保槽位在主节点间均匀分布，避免单节点数据量过大。

- 监控集群状态：通过Redis自带的redis-cli或第三方工具（如RedisInsight、Prometheus+Grafana）监控集群节点状态、内存使用、读写性能等指标，及时发现并解决问题。